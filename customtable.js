function drawViz(vizData,action){try{var body=document.getElementsByTagName("body")[0];if(height=dscc.getHeight(),width=dscc.getWidth(),"resize"!=action){var loader;document.body.innerHTML="",(loader=document.querySelector("#loaders"))?loader.style="display:block":((loader=document.createElement("div")).id="loaders",loader.style="display:block",document.body.appendChild(loader));var precisionRates=vizData.style.decprecpercent.value,precisionNumber=vizData.style.decprecnumber.value,precisionCurrency=vizData.style.decpreccurrency.value;"browser"===vizData.style.languagesettings.value?languagesettings=navigator.language:languagesettings=vizData.style.languagesettings.value;var yearformat=vizData.style.yearformat.value,monthformat=vizData.style.monthformat.value,dayformat=vizData.style.dayformat.value,weekdayformat=vizData.style.weekdayformat.value;comparisonselect=vizData.style.compmetric.value,compMetricdict={value:"compMetric",relative:"compMetricRel",absolute:"compMetricAbs"},displaycompMetricdict={value:"displaycompMetric",relative:"displaycompMetricRel",absolute:"displaycompMetricAbs"},compMetricvar={value:"val",relative:"rel",absolute:"abs"},1==vizData.style.advconfigmode.value?setsortable=!1:setsortable=vizData.style.sortable.value;var rowsperpage=Math.max(vizData.style.tablerows.value,1),perPageSelect=vizData.style.perPageSelect.value.split(",");perPageSelect.includes(rowsperpage)||perPageSelect.push(rowsperpage),perPageSelect.sort((function(a,b){return a-b}));var pagerperPage=vizData.style.pagerperPage.value,pagerinfo=vizData.style.pagerinfo.value,pagersearch=vizData.style.pagersearch.value,pagerinfofilter=vizData.style.pagerinfofilter.value;toprowlayout=vizData.style.toprowlayout.value,bottomrowlayout=vizData.style.bottomrowlayout.value,bothlayouts=toprowlayout+bottomrowlayout,bothlayouts.indexOf("{pager}")>-1||(bottomrowlayout+="{pager}"),textdateinfo=vizData.style.textdateinfo.value,textdateinfocomp=vizData.style.textdateinfocomp.value,labeldateinfo=textdateinfo+" "+textdateinfocomp;const JSTableDefaultConfig={perPage:rowsperpage,perPageSelect:perPageSelect,sortable:setsortable,searchable:!0,nextPrev:vizData.style.pagernextprev.value,firstLast:vizData.style.pagerfirstlast.value,prevText:"&lsaquo;",nextText:"&rsaquo;",firstText:"&laquo;",lastText:"&raquo;",ellipsisText:"&hellip;",truncatePager:vizData.style.pagertruncate.value,pagerDelta:vizData.style.pagerdelta.value,classes:{top:"dt-top",info:"dt-info",input:"dt-input",table:"dt-table",bottom:"dt-bottom",search:"dt-search",sorter:"dt-sorter",wrapper:"dt-wrapper",dropdown:"dt-dropdown",ellipsis:"dt-ellipsis",selector:"dt-selector",container:"dt-container",pagination:"dt-pagination",loading:"dt-loading",message:"dt-message",date:"dt-date"},labels:{placeholder:pagersearch,perPage:pagerperPage,noRows:"No entries found",info:pagerinfo,loading:"Loading...",infoFiltered:pagerinfo+pagerinfofilter,date:textdateinfo,datecomp:labeldateinfo},layout:{top:toprowlayout,bottom:bottomrowlayout},serverSide:!1,deferLoading:null,ajax:null,ajaxParams:{},queryParams:{page:"page",search:"search"},addQueryParams:!0};class JSTable{constructor(element,config={}){let DOMElement=element;"string"==typeof element&&(DOMElement=document.querySelector(element)),null!==DOMElement&&(this.config=this._merge(JSTableDefaultConfig,config),this.table=new JSTableElement(DOMElement),this.currentPage=1,this.columnRenderers=[],this.columnsNotSearchable=[],this.searchQuery=null,this.sortColumn=null,this.sortDirection="asc",this.isSearching=!1,this.filteredDataCount=null,this.pager=new JSTablePager(this),this._build(),this._buildColumns(),this.update(!this.config.serverSide),this._bindEvents(),this._emit("init"),this._parseQueryParams())}_build(){var that=this;let options=this.config;this.wrapper=document.createElement("div"),this.wrapper.className=options.classes.wrapper;var inner=["<div class='",options.classes.top,"'>",options.layout.top,"</div>","<div class='",options.classes.container,"'>","<div class='",options.classes.loading," hidden'>",options.labels.loading,"</div>","</div>","<div class='",options.classes.bottom,"'>",options.layout.bottom,"</div>"].join("");if(inner=(inner=inner.replace("{info}","<div class='"+options.classes.info+"'></div>")).replace("{date}","<div class='"+options.classes.date+"'><span></span></div>"),options.perPageSelect){var wrap=["<div class='",options.classes.dropdown,"'>","<label>",options.labels.perPage,"</label>","</div>"].join(""),select=document.createElement("select");select.className=options.classes.selector,options.perPageSelect.forEach((function(val){var selected=val===options.perPage,option=new Option(val,val,selected,selected);select.add(option)})),wrap=wrap.replace("{select}",select.outerHTML),inner=inner.replace(/\{select}/g,wrap)}else inner=inner.replace(/\{select}/g,"");if(options.searchable){var form=["<div class='",options.classes.search,"'>","<input class='",options.classes.input,"' placeholder='",options.labels.placeholder,"' type='text'>","</div>"].join("");inner=inner.replace(/\{search}/g,form)}else inner=inner.replace(/\{search}/g,"");let container;this.table.element.classList.add(options.classes.table),inner=inner.replace("{pager}","<div class='"+options.classes.pagination+"'></div>"),this.wrapper.innerHTML=inner,this.table.element.parentNode.replaceChild(this.wrapper,this.table.element),this.wrapper.querySelector("."+options.classes.container).appendChild(this.table.element),this._updatePagination(),this._updateInfo(),this._builddate()}async update(reloadData=!0){var that=this;this.currentPage>this.pager.getPages()&&(this.currentPage=this.pager.getPages());let loading=that.wrapper.querySelector(" ."+that.config.classes.loading);if(loading.classList.remove("hidden"),this.table.header.getCells().forEach((function(tableHeaderCell,columnIndex){let th=that.table.head.rows[0].cells[columnIndex];th.innerHTML=tableHeaderCell.getInnerHTML(),th.className=tableHeaderCell.classes.join(" ")||"";var addedclasses=tableHeaderCell.attributes["add-class"]||"";th.className=th.className+" "+addedclasses;for(let attr in tableHeaderCell.attributes)th.setAttribute(attr,tableHeaderCell.attributes[attr]);th.setAttribute("data-sortable",tableHeaderCell.isSortable)})),reloadData)return this.getPageData(this.currentPage).then((function(data){that.table.element.classList.remove("hidden"),that.table.body.innerHTML="",data.forEach((function(row){that.table.body.appendChild(row.getFormated(that.columnRenderers))})),loading.classList.add("hidden")})).then((function(){that.getDataCount()<=0&&(that.wrapper.classList.remove("search-results"),that.setMessage(that.config.labels.noRows)),that._emit("update")})).then((function(){that._updatePagination(),that._updateInfo(),that._builddate()}));that.table.element.classList.remove("hidden"),that.table.body.innerHTML="",this.getDataCount()<=0&&(that.wrapper.classList.remove("search-results"),that.setMessage(that.config.labels.noRows)),this._getData().forEach((function(row){that.table.body.appendChild(row.getFormated(that.columnRenderers))})),loading.classList.add("hidden")}_updatePagination(){let pagination=this.wrapper.querySelector(" ."+this.config.classes.pagination);pagination.innerHTML="",pagination.appendChild(this.pager.render(this.currentPage))}_updateInfo(){let info=this.wrapper.querySelector(" ."+this.config.classes.info),infoString=this.isSearching?this.config.labels.infoFiltered:this.config.labels.info;if(info&&infoString.length){var string=infoString.replace("{start}",this.getDataCount()>0?this._getPageStartIndex()+1:0).replace("{end}",this._getPageEndIndex()+1).replace("{page}",this.currentPage).replace("{pages}",this.pager.getPages()).replace("{rows}",this.getDataCount()).replace("{rowsTotal}",this.getDataCountTotal());info.innerHTML=string}}_builddate(){let dates=this.wrapper.querySelector(" ."+this.config.classes.date+" span"),dateString=vizData.tables.COMPARISON?this.config.labels.datecomp:this.config.labels.date;if(dates&&dateString.length&&vizData.dateRanges.DEFAULT){var startdate=new Date(Date.UTC(vizData.dateRanges.DEFAULT.start.substring(0,4),vizData.dateRanges.DEFAULT.start.substring(4,6)-1,vizData.dateRanges.DEFAULT.start.substring(6,8))).toLocaleString(languagesettings,{year:yearformat,month:monthformat,day:dayformat,timeZone:"UTC"}),enddate=new Date(Date.UTC(vizData.dateRanges.DEFAULT.end.substring(0,4),vizData.dateRanges.DEFAULT.end.substring(4,6)-1,vizData.dateRanges.DEFAULT.end.substring(6,8))).toLocaleString(languagesettings,{year:yearformat,month:monthformat,day:dayformat,timeZone:"UTC"}),string=dateString.replace("{startdate}",startdate).replace("{enddate}",enddate);if(vizData.dateRanges.COMPARISON){var cstartdate=new Date(Date.UTC(vizData.dateRanges.COMPARISON.start.substring(0,4),vizData.dateRanges.COMPARISON.start.substring(4,6)-1,vizData.dateRanges.COMPARISON.start.substring(6,8))).toLocaleString(languagesettings,{year:yearformat,month:monthformat,day:dayformat,timeZone:"UTC"}),cenddate=new Date(Date.UTC(vizData.dateRanges.COMPARISON.end.substring(0,4),vizData.dateRanges.COMPARISON.end.substring(4,6)-1,vizData.dateRanges.COMPARISON.end.substring(6,8))).toLocaleString(languagesettings,{year:yearformat,month:monthformat,day:dayformat,timeZone:"UTC"});string=(string=string.replace("{startdate_comp}",cstartdate)).replace("{enddate_comp}",cenddate)}dates.innerHTML=string}}_getPageStartIndex(){return(this.currentPage-1)*this.config.perPage}_getPageEndIndex(){let end=this.currentPage*this.config.perPage-1;return end>this.getDataCount()-1?this.getDataCount()-1:end}_getData(){return this._emit("getData",this.table.dataRows),this.table.dataRows.filter((function(row){return row.visible}))}_fetchData(){var that=this;let params={searchQuery:this.searchQuery,sortColumn:this.sortColumn,sortDirection:this.sortDirection,start:this._getPageStartIndex(),length:this.config.perPage,datatable:1};params=Object.assign({},this.config.ajaxParams,params);let query=this.config.ajax+"?"+this._queryParams(params);return fetch(query,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((function(response){return response.json()})).then((function(json){return that._emit("fetchData",json),that.filteredDataCount=json.recordsFiltered,json.data})).then((function(data){let rows=[];return data.forEach((function(dataRow){rows.push(JSTableRow.createFromData(dataRow))})),rows})).catch((function(error){console.error(error)}))}_queryParams(params){return Object.keys(params).map(k=>encodeURIComponent(k)+"="+encodeURIComponent(params[k])).join("&")}getDataCount(){return this.isSearching?this.getDataCountFiltered():this.getDataCountTotal()}getDataCountFiltered(){return this.config.serverSide?this.filteredDataCount:this._getData().length}getDataCountTotal(){return this.config.serverSide?this.config.deferLoading:this.table.dataRows.length}getPageData(){if(this.config.serverSide)return this._fetchData();let start_idx=this._getPageStartIndex();var end_idx=this._getPageEndIndex();return Promise.resolve(this._getData()).then((function(data){return data.filter((function(row,idx){return idx>=start_idx&&idx<=end_idx}))}))}async search(query){var that=this;return this.searchQuery=query.toLowerCase(),this.currentPage=1,this.isSearching=!0,this.searchQuery.length?(this.config.serverSide||this.table.dataRows.forEach((function(row){var match;row.visible=!1,that.searchQuery.split(" ").reduce((function(bool,word){var hasMatch=!1;let cells=row.getCells();return cells=cells.filter((function(cell,idx){if(that.columnsNotSearchable.indexOf(idx)<0)return!0})),hasMatch=cells.some((function(cell,idx){if(cell.getTextContent().toLowerCase().indexOf(word)>=0)return!0})),bool&&hasMatch}),!0)&&(row.visible=!0)})),this.wrapper.classList.add("search-results"),this.update().then((function(){that._emit("search",query)}))):(this.table.dataRows.forEach((function(row){row.visible=!0})),this.isSearching=!1,that.wrapper.classList.remove("search-results"),that.update(),!1)}sort(column,direction,initial=!1){var that=this;if(this.sortColumn=column||0,this.sortDirection=direction,this.sortColumn<0||this.sortColumn>this.table.getColumnCount()-1)return!1;var node=this.table.header.getCell(this.sortColumn),rows=this.table.dataRows;let tableHeaderCells;this.table.header.getCells().forEach((function(tableHeaderCell){tableHeaderCell.removeClass("asc"),tableHeaderCell.removeClass("desc")})),node.addClass(this.sortDirection),this.config.serverSide||(rows=rows.sort((function(a,b){var ca=a.getCellTextContent(that.sortColumn).toLowerCase(),cb=b.getCellTextContent(that.sortColumn).toLowerCase();return ca=ca.replace(/($|\,|\s|%)/g,""),cb=cb.replace(/($|\,|\s|%)/g,""),ca=isNaN(ca)||""===ca?ca:parseFloat(ca),cb=isNaN(cb)||""===cb?cb:parseFloat(cb),""===ca&&""!==cb?"asc"===that.sortDirection?1:-1:""!==ca&&""===cb?"asc"===that.sortDirection?-1:1:"asc"===that.sortDirection?ca===cb?0:ca>cb?1:-1:ca===cb?0:ca<cb?1:-1})),this.table.dataRows=rows),this.config.serverSide&&initial||this.update(),this._emit("sort",this.sortColumn,this.sortDirection)}async paginate(new_page){var that=this;return this.currentPage=new_page,this.update().then((function(){that._emit("paginate",that.currentPage,new_page)}))}_bindEvents(){var that=this;this.wrapper.addEventListener("click",(function(event){var node=event.target;if(node.hasAttribute("data-page")){event.preventDefault();let new_page=parseInt(node.getAttribute("data-page"),10);if(that.paginate(new_page),that.config.addQueryParams){const url=new URL(window.location.href);url.searchParams.set(that.config.queryParams.page,new_page),window.history.replaceState(null,null,url)}}if("TH"===node.nodeName&&node.hasAttribute("data-sortable")){if("false"===node.getAttribute("data-sortable"))return!1;event.preventDefault(),that.sort(node.cellIndex,node.classList.contains("asc")?"desc":"asc")}})),this.config.perPageSelect&&this.wrapper.addEventListener("change",(function(e){var node=e.target;if("SELECT"===node.nodeName&&node.classList.contains(that.config.classes.selector)){e.preventDefault();let value=parseInt(node.value,10);that._emit("perPageChange",that.config.perPage,value),that.config.perPage=value,that.update()}})),this.config.searchable&&this.wrapper.addEventListener("keyup",(function(e){if("INPUT"===e.target.nodeName&&e.target.classList.contains(that.config.classes.input)&&(e.preventDefault(),that.search(e.target.value),that.config.addQueryParams)){const url=new URL(window.location.href);url.searchParams.set(that.config.queryParams.search,e.target.value),window.history.replaceState(null,null,url)}}))}on(event,callback){this.events=this.events||{},this.events[event]=this.events[event]||[],this.events[event].push(callback)}off(event,callback){this.events=this.events||{},event in this.events!=!1&&this.events[event].splice(this.events[event].indexOf(callback),1)}_emit(event){if(this.events=this.events||{},event in this.events!=!1)for(var i=0;i<this.events[event].length;i++)this.events[event][i].apply(this,Array.prototype.slice.call(arguments,1))}setMessage(message){var colspan=this.table.getColumnCount(),node=document.createElement("tr");node.innerHTML='<td class="'+this.config.classes.message+'" colspan="'+colspan+'">'+message+"</td>",this.table.body.innerHTML="",this.table.body.appendChild(node)}_buildColumns(){var that=this;let initialSortColumn=null,initialSortDirection=null;this.config.columns&&this.config.columns.forEach((function(columnsDefinition){isNaN(columnsDefinition.select)||(columnsDefinition.select=[columnsDefinition.select]),columnsDefinition.select.forEach((function(column){var tableHeaderCell=that.table.header.getCell(column);if(void 0!==tableHeaderCell){if(columnsDefinition.hasOwnProperty("render")&&"function"==typeof columnsDefinition.render&&(that.columnRenderers[column]=columnsDefinition.render),columnsDefinition.hasOwnProperty("sortable")){let sortable=!1;tableHeaderCell.hasSortable?sortable=tableHeaderCell.isSortable:(sortable=columnsDefinition.sortable,tableHeaderCell.setSortable(sortable)),sortable&&(tableHeaderCell.addClass(that.config.classes.sorter),columnsDefinition.hasOwnProperty("sort")&&1===columnsDefinition.select.length&&(initialSortColumn=columnsDefinition.select[0],initialSortDirection=columnsDefinition.sort))}columnsDefinition.hasOwnProperty("searchable")&&(tableHeaderCell.addAttribute("data-searchable",columnsDefinition.searchable),!1===columnsDefinition.searchable&&that.columnsNotSearchable.push(column))}}))})),this.table.header.getCells().forEach((function(tableHeaderCell,columnIndex){null===tableHeaderCell.isSortable&&tableHeaderCell.setSortable(that.config.sortable),tableHeaderCell.isSortable&&(tableHeaderCell.addClass(that.config.classes.sorter),tableHeaderCell.hasSort&&(initialSortColumn=columnIndex,initialSortDirection=tableHeaderCell.sortDirection))})),null!==initialSortColumn&&that.sort(initialSortColumn,initialSortDirection,!0)}_merge(current,update){var that=this;return Object.keys(current).forEach((function(key){!update.hasOwnProperty(key)||"object"!=typeof update[key]||update[key]instanceof Array?update.hasOwnProperty(key)||(update[key]=current[key]):that._merge(current[key],update[key])})),update}async _parseQueryParams(){const urlParams=new URLSearchParams(window.location.search);let search=urlParams.get(this.config.queryParams.search);if(search){let searchfields;this.wrapper.querySelectorAll("."+this.config.classes.input).forEach((function(searchfield){searchfield.value=search})),await this.search(search)}let page=urlParams.get(this.config.queryParams.page);page&&await this.paginate(parseInt(page))}}class JSTableElement{constructor(element){this.element=element,this.body=this.element.tBodies[0],this.head=this.element.tHead,this.rows=Array.from(this.element.rows).map((function(row,rowID){return new JSTableRow(row,row.parentNode.nodeName,rowID)})),this.dataRows=this._getBodyRows(),this.header=this._getHeaderRow()}_getBodyRows(){return this.rows.filter((function(row){return!row.isHeader&&!row.isFooter}))}_getHeaderRow(){return this.rows.find((function(row){return row.isHeader}))}getColumnCount(){return this.header.getColumnCount()}getFooterRow(){return this.rows.find((function(row){return row.isFooter}))}}class JSTableRow{constructor(element,parentName="",rowID=null){this.cells=Array.from(element.cells).map((function(cell){return new JSTableCell(cell)})),this.d=this.cells.length,this.isHeader="THEAD"===parentName,this.isFooter="TFOOT"===parentName,this.visible=!0,this.rowID=rowID,this.attributes=element.attributes}getCells(){return Array.from(this.cells)}getAttributes(){return Array.from(this.attributes)}getColumnCount(){return this.cells.length}getCell(cell){return this.cells[cell]}getCellTextContent(cell){return this.getCell(cell).getTextContent()}static createFromData(data){let tr=document.createElement("tr");return data.forEach((function(cellData){let td=document.createElement("td");td.innerHTML=cellData,tr.appendChild(td)})),new JSTableRow(tr)}getFormated(renderer){let tr=document.createElement("tr");var that=this;return this.getAttributes().forEach((function(attr,idx){tr.setAttribute(attr.name,attr.value)})),this.getCells().forEach((function(cell,idx){var td=document.createElement("td");td.innerHTML=cell.getInnerHTML(),renderer.hasOwnProperty(idx)&&(td.innerHTML=renderer[idx].call(that,cell.getElement(),idx)),cell.classes.length>0&&(td.className=cell.classes.join(" "));for(let attr in cell.attributes)td.setAttribute(attr,cell.attributes[attr]);tr.appendChild(td)})),tr}setCellClass(cell,className){this.cells[cell].addClass(className)}}class JSTableCell{constructor(element){this.textContent=element.textContent,this.innerHTML=element.innerHTML,this.className="",this.element=element,this.hasSortable=element.hasAttribute("data-sortable"),this.isSortable=this.hasSortable?"true"===element.getAttribute("data-sortable"):null,this.hasSort=element.hasAttribute("data-sort"),this.sortDirection=element.getAttribute("data-sort"),this.classes=[];var that=this;this.attributes={},[...element.attributes].forEach((function(attr){that.attributes[attr.name]=attr.value}))}getElement(){return this.element}getTextContent(){var attr=this.attributes["data-value"];return attr||this.textContent}getInnerHTML(){return this.innerHTML}setClass(className){this.className=className}setSortable(value){this.isSortable=value}addClass(value){this.classes.push(value)}removeClass(value){this.classes.indexOf(value)>=0&&this.classes.splice(this.classes.indexOf(value),1)}addAttribute(key,value){this.attributes[key]=value}}class JSTablePager{constructor(instance){this.instance=instance}getPages(){let pages=Math.ceil(this.instance.getDataCount()/this.instance.config.perPage);return 0===pages?1:pages}render(){var options=this.instance.config;let pages=this.getPages(),ul=document.createElement("ul");if(pages>1){let prev=1===this.instance.currentPage?1:this.instance.currentPage-1,next=this.instance.currentPage===pages?pages:this.instance.currentPage+1;var pager;options.firstLast&&ul.appendChild(this.createItem("pager",1,options.firstText)),options.nextPrev&&ul.appendChild(this.createItem("pager",prev,options.prevText)),this.truncate().forEach((function(btn){ul.appendChild(btn)})),options.nextPrev&&ul.appendChild(this.createItem("pager",next,options.nextText)),options.firstLast&&ul.appendChild(this.createItem("pager",pages,options.lastText))}return ul}createItem(className,pageNum,content,ellipsis){let item=document.createElement("li");return item.className=className,item.innerHTML=ellipsis?"<span>"+content+"</span>":'<a href="#" data-page="'+pageNum+'">'+content+"</a>",item}isValidPage(page){return page>0&&page<=this.getPages()}truncate(){var that=this,options=that.instance.config,delta=2*options.pagerDelta,currentPage=that.instance.currentPage,left=currentPage-options.pagerDelta,right=currentPage+options.pagerDelta,totalPages=this.getPages(),range=[],pager=[],lastIndex;if(this.instance.config.truncatePager){currentPage<4-options.pagerDelta+delta?right=3+delta:currentPage>this.getPages()-(3-options.pagerDelta+delta)&&(left=this.getPages()-(2+delta));for(var i=1;i<=totalPages;i++)(1===i||i===totalPages||i>=left&&i<=right)&&range.push(i);range.forEach((function(index){lastIndex&&(index-lastIndex==2?pager.push(that.createItem("",lastIndex+1,lastIndex+1)):index-lastIndex!=1&&pager.push(that.createItem(options.classes.ellipsis,0,options.ellipsisText,!0))),pager.push(that.createItem(index==currentPage?"active":"",index,index)),lastIndex=index}))}else for(let i=1;i<=this.getPages();i++)pager.push(this.createItem(i===currentPage?"active":"",i,i));return pager}}if(window.JSTable=JSTable,def=JSON.parse(JSON.stringify(vizData.tables.DEFAULT)),vizData.tables.COMPARISON)var comp=JSON.parse(JSON.stringify(vizData.tables.COMPARISON));if(comp){for(var compmap={},i=0;i<comp.length;i++)compmap[JSON.stringify(comp[i].Dimension)]=comp[i].Metric;for(i=0;i<def.length;i++)def[i].compMetric=compmap[JSON.stringify(def[i].Dimension)]||null;if(!0===vizData.style.lostdata.value){for(var defmap={},i=0;i<def.length;i++)defmap[JSON.stringify(def[i].Dimension)]=def[i].Metric;for(i=0;i<comp.length;i++)defmap[JSON.stringify(comp[i].Dimension)]||def.push({Dimension:comp[i].Dimension,Metric:null,compMetric:comp[i].Metric})}!1===vizData.style.newdata.value&&(def=def.filter((function(item){return null!==item.compMetric}))),!1===vizData.style.bothdata.value&&(def=def.filter((function(item){return null===item.compMetric||null===item.Metric})))}var dimsmets=[],advusage=vizData.style.advusage.value;for(allfields=JSON.parse(JSON.stringify(vizData.fields)),i=0;i<allfields.Dimension.length;i++){var dimskey;if(""==(dimskey=allfields.Dimension[i][advusage].replace(/[^a-zA-Z0-9]/g,"").toLowerCase())&&(dimskey="dimension"),dimskey.match(/^\d/)&&(dimskey="dim"+dimskey),dimsmets[dimskey])for(check=2;check<20;check++)dimsmets[dimskey+check]||(dimsmets[dimskey+check]=allfields.Dimension[i],dimsmets[dimskey+check].nr=i,dimsmets[dimskey+check].idkey=dimskey+check,check=20);else dimsmets[dimskey]=allfields.Dimension[i],dimsmets[dimskey].nr=i,dimsmets[dimskey].idkey=dimskey}for(i=0;i<allfields.Metric.length;i++){var dimskey;if(""==(dimskey=allfields.Metric[i][advusage].replace(/[^a-zA-Z0-9]/g,"").toLowerCase())&&(dimskey="metric"),dimskey.match(/^\d/)&&(dimskey="met"+dimskey),dimsmets[dimskey])for(check=2;check<20;check++)dimsmets[dimskey+check]||(dimsmets[dimskey+check]=allfields.Metric[i],dimsmets[dimskey+check].nr=i,dimsmets[dimskey+check].idkey=dimskey+check,check=20);else dimsmets[dimskey]=allfields.Metric[i],dimsmets[dimskey].nr=i,dimsmets[dimskey].idkey=dimskey}colinput=vizData.style.advcolumns.value,definput="",deffields=Object.keys(dimsmets);var helparray={};for(deffields.forEach(field=>{helparray[dimsmets[field].concept+dimsmets[field].nr]=field}),i=0;i<Object.keys(helparray).length;i++)Object.keys(helparray)[i].indexOf("DIMENSION")>-1&&(definput=definput+","+helparray[Object.keys(helparray)[i]]),Object.keys(helparray)[i].indexOf("METRIC")>-1&&(definput=comp?definput+","+helparray[Object.keys(helparray)[i]]+","+helparray[Object.keys(helparray)[i]]+"_comp"+compMetricvar[comparisonselect]:definput+","+helparray[Object.keys(helparray)[i]]);""===colinput&&(colinput=definput.substring(1)),","==colinput.slice(-1)&&(colinput=colinput.substring(0,colinput.length-1)),colinput=colinput.toLowerCase().replaceAll(" ","").replace(/(?:\r\n|\r|\n)/g,"").split(","),finalcols=[],colinput.forEach((function(inp){var namedimsmets=inp.split("_")[0],nr=dimsmets[namedimsmets].nr;if(inp.split("_")[1])var finalname="Î”",concept="COMPARISON";else var finalname=dimsmets[namedimsmets].name,concept=dimsmets[namedimsmets].concept,finalid=dimsmets[namedimsmets].id,type=dimsmets[namedimsmets].type;if("DIMENSION"===concept)var finalvar="Dimension",finaldisplayvar="displayDimension";else if("METRIC"===concept)var finalvar="Metric",finaldisplayvar="displayMetric";else if("COMPARISON"===concept)if("compval"==inp.split("_")[1])var finalvar="compMetric",finaldisplayvar="displaycompMetric",type=dimsmets[inp.split("_")[0]].type;else if("comprel"==inp.split("_")[1])var finalvar="compMetricRel",finaldisplayvar="displaycompMetricRel",type="PERCENT";else if("compabs"==inp.split("_")[1])var finalvar="compMetricAbs",finaldisplayvar="displaycompMetricAbs",type=dimsmets[inp.split("_")[0]].type;var finalcol={var:finalvar,displayvar:finaldisplayvar,concept:concept,name:finalname,nr:nr,key:inp,id:finalid,type:type};finalcols.push(finalcol)}));var fixedJSON="{"+vizData.style.advnames.value.replace(/(?:\r\n|\r|\n)/g,"")+"}".replace(/:\s*"([^"]*)"/g,(function(match,p1){return': "'+p1.replace(/:/g,"@colon@")+'"'})).replace(/:\s*'([^']*)'/g,(function(match,p1){return': "'+p1.replace(/:/g,"@colon@")+'"'})).replace(/(['"])?([a-z0-9A-Z_]+)(['"])?\s*:/g,'"": ').replace(/@colon@/g,":"),columnnames=JSON.parse(fixedJSON),groupJSON="{"+vizData.style.advgrouping.value.replace(/(?:\r\n|\r|\n)/g,"")+"}",columngroups=JSON.parse(groupJSON);for(i=0;i<Object.keys(columngroups).length;i++)columngroups[Object.keys(columngroups)[i]].sort((function(a,b){return a-b}));toHHMMSS=secs=>{var sec_num=parseInt(secs,10),hours,minutes,seconds;return sec_numpos=sec_num<0?0-sec_num:sec_num,[Math.floor(sec_numpos/3600),Math.floor(sec_numpos/60)%60,sec_numpos%60].map(v=>v<10?"0"+v:v).filter((v,i)=>"00"!==v||i>=0).join(":")},maxvals={Metric:[],compMetric:[],compMetricRel:[],compMetricAbs:[]},minvals={Metric:[],compMetric:[],compMetricRel:[],compMetricAbs:[]};var decprecJSON="{"+vizData.style.advdecprec.value.replace(/(?:\r\n|\r|\n)/g,"")+"}",decprec=JSON.parse(decprecJSON);def.forEach((function(row){for(var i=0;i<vizData.fields.Metric.length;i++)row.compMetric=row.compMetric||[],row.compMetric.length>i||row.compMetric[i]||row.compMetric.push(null),row.Metric=row.Metric||[],row.Metric.length>i||row.Metric[i]||row.Metric.push(null);row.Dimension&&(row.displayDimension=JSON.parse(JSON.stringify(row.Dimension))),row.Metric&&(row.displayMetric=JSON.parse(JSON.stringify(row.Metric))),row.compMetric&&(row.displaycompMetric=JSON.parse(JSON.stringify(row.compMetric))),comp&&(row.compMetricRel=[],row.compMetricAbs=[],row.displaycompMetricRel=[],row.displaycompMetricAbs=[]);for(var i=0;i<vizData.fields.Metric.length;i++)null===row.Metric[i]&&(row.Metric[i]=0),null===row.compMetric[i]&&(row.compMetric[i]=0),comp&&(row.compMetric?row.Metric?(row.compMetricAbs.push(row.Metric[i]-row.compMetric[i]),row.displaycompMetricAbs.push(row.Metric[i]-row.compMetric[i]),row.compMetricRel.push((row.Metric[i]-row.compMetric[i])/row.compMetric[i]),row.displaycompMetricRel.push((row.Metric[i]-row.compMetric[i])/row.compMetric[i])):(row.compMetricAbs.push(0-row.compMetric[i]),row.displaycompMetricAbs.push(0-row.compMetric[i]),row.compMetricRel.push((0-row.compMetric[i])/row.compMetric[i]),row.displaycompMetricRel.push((0-row.compMetric[i])/row.compMetric[i])):(row.compMetricAbs.push(row.Metric[i]),row.displaycompMetricAbs.push(row.Metric[i]),row.compMetricRel.push(null),row.displaycompMetricRel.push(null)),row.compMetricRel[i]===1/0&&(row.compMetricRel[i]=1),isNaN(row.compMetricRel[i])&&(row.compMetricRel[i]=0)),maxvals.Metric[i]?maxvals.Metric[i]=parseFloat(maxvals.Metric[i])>parseFloat(row.Metric[i])?maxvals.Metric[i]:row.Metric[i]:maxvals.Metric[i]=row.Metric[i],minvals.Metric[i]?minvals.Metric[i]=parseFloat(minvals.Metric[i])<parseFloat(row.Metric[i])?minvals.Metric[i]:row.Metric[i]:minvals.Metric[i]=row.Metric[i],comp&&(maxvals.compMetric[i]?maxvals.compMetric[i]=maxvals.compMetric[i]>row.compMetric[i]?maxvals.compMetric[i]:row.compMetric[i]:maxvals.compMetric[i]=row.compMetric[i],maxvals.compMetricRel[i]?maxvals.compMetricRel[i]=maxvals.compMetricRel[i]>row.compMetricRel[i]?maxvals.compMetricRel[i]:row.compMetricRel[i]:maxvals.compMetricRel[i]=row.compMetricRel[i],maxvals.compMetricAbs[i]?maxvals.compMetricAbs[i]=maxvals.compMetricAbs[i]>row.compMetricAbs[i]?maxvals.compMetricAbs[i]:row.compMetricAbs[i]:maxvals.compMetricAbs[i]=row.compMetricAbs[i],minvals.compMetric[i]?minvals.compMetric[i]=minvals.compMetric[i]<row.compMetric[i]?minvals.compMetric[i]:row.compMetric[i]:minvals.compMetric[i]=row.compMetric[i],minvals.compMetricRel[i]?minvals.compMetricRel[i]=minvals.compMetricRel[i]<row.compMetricRel[i]?minvals.compMetricRel[i]:row.compMetricRel[i]:minvals.compMetricRel[i]=row.compMetricRel[i],minvals.compMetricAbs[i]?minvals.compMetricAbs[i]=minvals.compMetricAbs[i]<row.compMetricAbs[i]?minvals.compMetricAbs[i]:row.compMetricAbs[i]:minvals.compMetricAbs[i]=row.compMetricAbs[i])})),def.forEach((function(row){for(var i=0;i<finalcols.length;i++){var textmissingval;if(textmissingval="COMPARISON"==finalcols[i].concept?vizData.style.textcompmissing.value:vizData.style.textmissing.value,"DIMENSION"!=finalcols[i].concept){if(isNaN(row[finalcols[i].var][finalcols[i].nr])&&(row[finalcols[i].var][finalcols[i].nr]=0),row[finalcols[i].var][finalcols[i].nr]===1/0&&(row[finalcols[i].var][finalcols[i].nr]=1),isNaN(row[finalcols[i].displayvar][finalcols[i].nr])&&(row[finalcols[i].displayvar][finalcols[i].nr]=0),"DURATION"===finalcols[i].type)if(null!=row[finalcols[i].displayvar][finalcols[i].nr]){if(row[finalcols[i].displayvar][finalcols[i].nr]<0)var control="-";else var control="";row[finalcols[i].displayvar][finalcols[i].nr]=control+toHHMMSS(row[finalcols[i].displayvar][finalcols[i].nr])}else row[finalcols[i].displayvar][finalcols[i].nr]="0"==textmissingval?toHHMMSS(0):textmissingval;var deciprec;finalcols[i].type.startsWith("CURRENCY")&&(deciprec=precisionCurrency),"PERCENT"==finalcols[i].type&&(deciprec=precisionRates),"NUMBER"==finalcols[i].type&&(deciprec=precisionNumber),null!=decprec[finalcols[i].key]&&(deciprec=decprec[finalcols[i].key]);var pctformatter=new Intl.NumberFormat(languagesettings,{style:"percent",maximumFractionDigits:deciprec,minimumFractionDigits:deciprec});if(finalcols[i].type.startsWith("CURRENCY"))var ccode=String(finalcols[i].type.replace("CURRENCY_ ","")),currformatter=new Intl.NumberFormat(languagesettings,{style:"currency",currency:ccode,maximumFractionDigits:deciprec,minimumFractionDigits:deciprec});var numformatter=new Intl.NumberFormat(languagesettings,{style:"decimal",maximumFractionDigits:deciprec,minimumFractionDigits:deciprec});"PERCENT"===finalcols[i].type&&(null!=row[finalcols[i].displayvar][finalcols[i].nr]&&null!=row[finalcols[i].displayvar][finalcols[i].nr]?row[finalcols[i].displayvar][finalcols[i].nr]=pctformatter.format(row[finalcols[i].displayvar][finalcols[i].nr]):row[finalcols[i].displayvar][finalcols[i].nr]="0"==textmissingval?pctformatter.format(0):textmissingval),finalcols[i].type.startsWith("CURRENCY")&&(null!=row[finalcols[i].displayvar][finalcols[i].nr]?row[finalcols[i].displayvar][finalcols[i].nr]=currformatter.format(row[finalcols[i].displayvar][finalcols[i].nr]):row[finalcols[i].displayvar][finalcols[i].nr]="0"==textmissingval?currformatter.format(0):textmissingval),"NUMBER"===finalcols[i].type&&(null!=row[finalcols[i].displayvar][finalcols[i].nr]?row[finalcols[i].displayvar][finalcols[i].nr]=numformatter.format(row[finalcols[i].displayvar][finalcols[i].nr]):row[finalcols[i].displayvar][finalcols[i].nr]="0"==textmissingval?numformatter.format(0):textmissingval),isNaN(row[finalcols[i].var][finalcols[i].nr])&&(row[finalcols[i].var][finalcols[i].nr]=0),row[finalcols[i].var][finalcols[i].nr]===1/0&&(row[finalcols[i].var][finalcols[i].nr]=1)}if("DIMENSION"===finalcols[i].concept){if("YEAR_MONTH"===finalcols[i].type){var datestring=row[finalcols[i].displayvar][finalcols[i].nr],newdate=new Date(Date.UTC(datestring.substring(0,4),datestring.substring(4,6)-1));row[finalcols[i].displayvar][finalcols[i].nr]=newdate.toLocaleString(languagesettings,{year:"numeric",month:"short",timeZone:"UTC"})}if("YEAR_MONTH_DAY"===finalcols[i].type){var datestring=row[finalcols[i].displayvar][finalcols[i].nr],newdate=new Date(Date.UTC(datestring.substring(0,4),datestring.substring(4,6)-1,datestring.substring(6,8)));row[finalcols[i].displayvar][finalcols[i].nr]=newdate.toLocaleString(languagesettings,{year:yearformat,month:monthformat,day:dayformat,timeZone:"UTC"})}if("YEAR_MONTH_DAY_HOUR"===finalcols[i].type){var datestring=row[finalcols[i].displayvar][finalcols[i].nr],newdate=new Date(Date.UTC(datestring.substring(0,4),datestring.substring(4,6)-1,datestring.substring(6,8),datestring.substring(8,10)));row[finalcols[i].displayvar][finalcols[i].nr]=newdate.toLocaleString(languagesettings,{year:yearformat,month:monthformat,day:dayformat,hour:"2-digit",timeZone:"UTC"})}if("YEAR_MONTH_DAY_MINUTE"===finalcols[i].type){var datestring=row[finalcols[i].displayvar][finalcols[i].nr],newdate=new Date(Date.UTC(datestring.substring(0,4),datestring.substring(4,6)-1,datestring.substring(6,8),datestring.substring(8,10),datestring.substring(10,12)));row[finalcols[i].displayvar][finalcols[i].nr]=newdate.toLocaleString(languagesettings,{year:yearformat,month:monthformat,day:dayformat,hour:"2-digit",minute:"2-digit",timeZone:"UTC"})}if("YEAR_MONTH_DAY_SECOND"===finalcols[i].type){var datestring=row[finalcols[i].displayvar][finalcols[i].nr],newdate=new Date(Date.UTC(datestring.substring(0,4),datestring.substring(4,6)-1,datestring.substring(6,8),datestring.substring(8,10),datestring.substring(10,12),datestring.substring(12,14)));row[finalcols[i].displayvar][finalcols[i].nr]=newdate.toLocaleString(languagesettings,{year:yearformat,month:monthformat,day:dayformat,hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"UTC"})}if("YEAR_QUARTER"===finalcols[i].type){var datestring=row[finalcols[i].displayvar][finalcols[i].nr].substring(0,4),newdate=new Date(Date.UTC(datestring));row[finalcols[i].displayvar][finalcols[i].nr]=newdate.toLocaleString(languagesettings,{year:yearformat,timeZone:"UTC"})+" "+row[finalcols[i].displayvar][finalcols[i].nr].substring(4,6)}if("YEAR_WEEK"===finalcols[i].type){var datestring=row[finalcols[i].displayvar][finalcols[i].nr].substring(0,4),newdate=new Date(Date.UTC(datestring));row[finalcols[i].displayvar][finalcols[i].nr]=newdate.toLocaleString(languagesettings,{year:yearformat,timeZone:"UTC"})+"-"+row[finalcols[i].displayvar][finalcols[i].nr].substring(4,6)}if("MONTH"===finalcols[i].type){var datestring=row[finalcols[i].displayvar][finalcols[i].nr],newdate=new Date(Date.UTC(2e3,datestring.substring(0,2)-1));row[finalcols[i].displayvar][finalcols[i].nr]=newdate.toLocaleString(languagesettings,{month:monthformat,timeZone:"UTC"})}if("YEAR"===finalcols[i].type){var datestring=row[finalcols[i].displayvar][finalcols[i].nr],newdate=new Date(Date.UTC(datestring));row[finalcols[i].displayvar][finalcols[i].nr]=newdate.toLocaleString(languagesettings,{year:yearformat,timeZone:"UTC"})}if("QUARTER"===finalcols[i].type&&(row[finalcols[i].displayvar][finalcols[i].nr]="Q"+row[finalcols[i].displayvar][finalcols[i].nr]),"MONTH_DAY"===finalcols[i].type){var datestring=row[finalcols[i].displayvar][finalcols[i].nr],newdate=new Date(Date.UTC(2e3,datestring.substring(0,2)-1,datestring.substring(2,4)));row[finalcols[i].displayvar][finalcols[i].nr]=newdate.toLocaleString(languagesettings,{month:monthformat,day:dayformat,timeZone:"UTC"})}if("DAY_OF_WEEK"===finalcols[i].type){var datestring=row[finalcols[i].displayvar][finalcols[i].nr],newdate=new Date(Date.UTC(2021,2,datestring));row[finalcols[i].displayvar][finalcols[i].nr]=newdate.toLocaleString(languagesettings,{weekday:weekdayformat,timeZone:"UTC"})}if("HYPERLINK"===finalcols[i].type){var ahref=null!=row[finalcols[i].displayvar][finalcols[i].nr]?row[finalcols[i].displayvar][finalcols[i].nr].split(String.fromCharCode(160)+String.fromCharCode(160))[1]:"https://null",atext=null!=row[finalcols[i].displayvar][finalcols[i].nr]?row[finalcols[i].displayvar][finalcols[i].nr].split(String.fromCharCode(160)+String.fromCharCode(160))[0]:textmissingval;row[finalcols[i].displayvar][finalcols[i].nr]="<a href='"+ahref+"' target='_blank'>"+atext+"</a>"}if("IMAGE"===finalcols[i].type){var realurl=null!=row[finalcols[i].displayvar][finalcols[i].nr]?row[finalcols[i].displayvar][finalcols[i].nr].split(String.fromCharCode(160)+String.fromCharCode(160))[0]:"https://null",googleurl=null!=row[finalcols[i].displayvar][finalcols[i].nr]?row[finalcols[i].displayvar][finalcols[i].nr].split(String.fromCharCode(160)+String.fromCharCode(160))[1]:"https://null",alttext=null!=row[finalcols[i].displayvar][finalcols[i].nr]?row[finalcols[i].displayvar][finalcols[i].nr].split(String.fromCharCode(160)+String.fromCharCode(160))[2]:textmissingval;null==row[finalcols[i].displayvar][finalcols[i].nr]?row[finalcols[i].displayvar][finalcols[i].nr]=alttext:row[finalcols[i].displayvar][finalcols[i].nr]="<img src='"+googleurl+"' alt='"+alttext+"'>"}}}}));var weightedsort=vizData.style.weightedsort.value;if(1==weightedsort){docalc="";var sortmetric={},weightmetric={},sumweight=0,sumproduct=0;for(i=0;i<finalcols.length;i++)finalcols[i].key==vizData.style.sortingfield.value&&"DIMENSION"!=finalcols[i].key&&(docalc+="ok",sortmetric.var=finalcols[i].var,sortmetric.nr=finalcols[i].nr),finalcols[i].key==vizData.style.weightedsortfield.value&&"DIMENSION"!=finalcols[i].key&&(docalc+="ok",weightmetric.var=finalcols[i].var,weightmetric.nr=finalcols[i].nr);if("okok"==docalc)for(j=0;j<def.length;j++)sumweight+=def[j][weightmetric.var][weightmetric.nr],sumproduct+=def[j][weightmetric.var][weightmetric.nr]*def[j][sortmetric.var][sortmetric.nr];avgsort=sumproduct/sumweight}var body=document.getElementsByTagName("body")[0],tbl;(tbl=document.createElement("table")).setAttribute("transpose",vizData.style.transpose.value),tbl.id="customtable",tbl.setAttribute("configmode",vizData.style.advconfigmode.value);for(var tblBody=document.createElement("tbody"),tblHead=document.createElement("thead"),headrow=document.createElement("tr"),i=0;i<finalcols.length;i++){var cell;(cell=document.createElement("th")).setAttribute("add-class",finalcols[i].concept.toLowerCase()+" "+finalcols[i].key),cell.setAttribute("data-class","th."+finalcols[i].concept.toLowerCase()+"."+finalcols[i].key),cell.innerHTML=columnnames[finalcols[i].key]?columnnames[finalcols[i].key]:finalcols[i].name,vizData.style.sortingfield.value==finalcols[i].key&&(cell.setAttribute("data-sort",vizData.style.sortingdirection.value),cell.setAttribute("data-sortable","true")),1==vizData.style.advconfigmode.value&&(cell.innerHTML=cell.innerHTML+"<br><br> <span style='font-weight:normal'>th."+finalcols[i].concept.toLowerCase()+"."+finalcols[i].key+"</span>"),headrow.appendChild(cell)}for(var j=0;j<def.length;j++){var row;(row=document.createElement("tr")).setAttribute("data-id",j),row.setAttribute("filter","none");for(var i=0;i<finalcols.length;i++){var cell;(cell=document.createElement("td")).classList.add(finalcols[i].concept.toLowerCase()),cell.classList.add(finalcols[i].key),"DIMENSION"==finalcols[i].concept&&(row.setAttribute(finalcols[i].key,def[j][finalcols[i].var][finalcols[i].nr]),row.setAttribute("data-dimids",(row.getAttribute("data-dimids")?row.getAttribute("data-dimids")+",":"")+finalcols[i].id),row.setAttribute("data-dimvals"+(row.getAttribute("data-dimids").split(",").length-1),def[j][finalcols[i].var][finalcols[i].nr]));var posneg="",pctvalue=0;if("DIMENSION"!=finalcols[i].concept){def[j][finalcols[i].var][finalcols[i].nr]>0?(posneg=".pos",cell.classList.add("pos")):def[j][finalcols[i].var][finalcols[i].nr]<0?(posneg=".neg",cell.classList.add("neg")):(posneg=".null",cell.classList.add("null")),pctvalue=(def[j][finalcols[i].var][finalcols[i].nr]-minvals[finalcols[i].var][finalcols[i].nr])/(maxvals[finalcols[i].var][finalcols[i].nr]-minvals[finalcols[i].var][finalcols[i].nr])*100,pct0value=100*Math.max((0-minvals[finalcols[i].var][finalcols[i].nr])/(maxvals[finalcols[i].var][finalcols[i].nr]-minvals[finalcols[i].var][finalcols[i].nr]),0),pctvalueto0=(def[j][finalcols[i].var][finalcols[i].nr]-Math.min(minvals[finalcols[i].var][finalcols[i].nr],0))/(Math.max(maxvals[finalcols[i].var][finalcols[i].nr],0)-Math.min(minvals[finalcols[i].var][finalcols[i].nr],0))*100;for(var pctvaluecomp=0,pct0valuecomp=0,pctvalueto0comp=0,x=0;x<finalcols.length;x++)finalcols[i]==finalcols[x]||finalcols[i].key!=finalcols[x].key+"_compval"&&finalcols[i].key+"_compval"!=finalcols[x].key||(finalcols[i].compvals="true");if("true"==finalcols[i].compvals){if("Metric"==finalcols[i].var)var finalcomp="compMetric";if("compMetric"==finalcols[i].var)var finalcomp="Metric";pctvaluecomp=(def[j][finalcols[i].var][finalcols[i].nr]-Math.min(minvals[finalcols[i].var][finalcols[i].nr],minvals[finalcomp][finalcols[i].nr]))/(Math.max(maxvals[finalcols[i].var][finalcols[i].nr],maxvals[finalcomp][finalcols[i].nr])-Math.min(minvals[finalcols[i].var][finalcols[i].nr],minvals[finalcomp][finalcols[i].nr]))*100,pct0valuecomp=100*Math.max((0-Math.min(minvals[finalcols[i].var][finalcols[i].nr],minvals[finalcomp][finalcols[i].nr]))/(Math.max(maxvals[finalcols[i].var][finalcols[i].nr],maxvals[finalcomp][finalcols[i].nr])-Math.min(minvals[finalcols[i].var][finalcols[i].nr],minvals[finalcomp][finalcols[i].nr])),0),pctvalueto0comp=(def[j][finalcols[i].var][finalcols[i].nr]-Math.min(Math.min(minvals[finalcols[i].var][finalcols[i].nr],minvals[finalcomp][finalcols[i].nr]),0))/(Math.max(Math.max(maxvals[finalcols[i].var][finalcols[i].nr],maxvals[finalcomp][finalcols[i].nr]),0)-Math.min(Math.min(minvals[finalcols[i].var][finalcols[i].nr],minvals[finalcomp][finalcols[i].nr]),0))*100}}"DIMENSION"!=finalcols[i].concept&&def[j][finalcols[i].var][finalcols[i].nr]===maxvals[finalcols[i].var][finalcols[i].nr]?(cell.classList.add("max"),configmax=".max"):configmax="","DIMENSION"!=finalcols[i].concept&&def[j][finalcols[i].var][finalcols[i].nr]===minvals[finalcols[i].var][finalcols[i].nr]?(cell.classList.add("min"),configmin=".min"):configmin="","DIMENSION"!=finalcols[i].concept&&(cell.style="--minval:"+minvals[finalcols[i].var][finalcols[i].nr]+";--maxval:"+maxvals[finalcols[i].var][finalcols[i].nr]+";--pctval:"+pctvalue+";--val:"+def[j][finalcols[i].var][finalcols[i].nr]+";--pctvalof0:"+pct0value+";--tonullpctval:"+pctvalueto0+";--pctvalcomp:"+pctvaluecomp+";--pctvalof0comp:"+pct0valuecomp+";--tonullpctvalcomp:"+pctvalueto0comp);for(var x=0;x<finalcols.length;x++)"DIMENSION"!=finalcols[x].concept&&(cell.style=cell.style.cssText+";--m_"+finalcols[x].key+":"+def[j][finalcols[x].var][finalcols[x].nr]);cell.setAttribute("data-class","td."+finalcols[i].concept.toLowerCase()+"."+finalcols[i].key);var cellgroup="";if(columngroups[finalcols[i].key]){var groupvals=columngroups[finalcols[i].key],datavalue=def[j][finalcols[i].var][finalcols[i].nr];for(g=0;g<groupvals.length;g++){if(datavalue<=groupvals[g]){cellgroup="group"+g,cell.classList.add(cellgroup),cell.setAttribute("data-group",g),row.setAttribute(finalcols[i].key,"group"+g);break}g+1==groupvals.length&&(cellgroup="group"+(g+1),cell.classList.add(cellgroup),cell.setAttribute("data-group",g+1),row.setAttribute(finalcols[i].key,"group"+(g+1)))}}if(cellgroup.length>0&&(cellgroup="."+cellgroup),0==vizData.style.advconfigmode.value?cell.innerHTML=def[j][finalcols[i].displayvar][finalcols[i].nr]:1==vizData.style.advconfigmode.value&&(cell.innerHTML="td."+finalcols[i].concept.toLowerCase()+"."+finalcols[i].key+configmax+configmin+posneg+cellgroup+"<br><br> data-value:"+def[j][finalcols[i].var][finalcols[i].nr]),cell.setAttribute("data-field",finalcols[i].key),1==weightedsort&&finalcols[i].key==vizData.style.sortingfield.value&&avgsort){var V=def[j][weightmetric.var][weightmetric.nr],MV=maxvals[finalcols[i].var][finalcols[i].nr],B,AB,newvalue=V/MV*def[j][finalcols[i].var][finalcols[i].nr]+(1-V/MV)*avgsort;cell.setAttribute("data-value",newvalue)}else cell.setAttribute("data-value",def[j][finalcols[i].var][finalcols[i].nr]);row.appendChild(cell)}tblBody.appendChild(row)}if(tblHead.appendChild(headrow),tbl.appendChild(tblHead),tbl.appendChild(tblBody),body.appendChild(tbl),maintable=new JSTable("#customtable"),"FILTER"==vizData.interactions.crossfilter.value.type){tabbody=document.querySelector("tbody");var bodyrows=document.querySelectorAll("tbody tr");if(tabbody.addEventListener("click",(function(elem){var bodyrows=document.querySelectorAll("tbody tr");if("TD"==elem.srcElement.nodeName)var selectrow=elem.srcElement.parentElement;else if("TD"==elem.srcElement.parentElement.nodeName)var selectrow=elem.srcElement.parentElement.parentElement;if(selectrow)for(var j=0;j<bodyrows.length;j++)if(bodyrows[j].innerHTML==selectrow.innerHTML){if("none"!=selectrow.getAttribute("filter")){document.querySelectorAll("tbody tr").forEach((function(element){element.setAttribute("filter","none")})),maintable.table.dataRows.forEach(x=>x.attributes.filter.value="none"),clearInteraction();break}for(document.querySelectorAll("tbody tr")[j].setAttribute("filter","on"),maintable.table.dataRows.forEach(x=>x.attributes.filter.value="off"),maintable.table.dataRows[selectrow.getAttribute("data-id")].attributes.filter.value="on",arrconcepts=selectrow.getAttribute("data-dimids").split(","),arrvalues=[[]],x=0;x<arrconcepts.length;x++)arrvalues[0].push(selectrow.getAttribute("data-dimvals"+x));var interactionData;sendinteraction({concepts:arrconcepts,values:arrvalues})}else document.querySelectorAll("tbody tr")[j].setAttribute("filter","off")}),!1),null!=vizData.interactions.crossfilter.value.data){for(var actconcepts=vizData.interactions.crossfilter.value.data.concepts,actvalues=vizData.interactions.crossfilter.value.data.values[0],rowselector='tr[data-dimids="',c=0;c<actconcepts.length;c++)0==c?rowselector+=actconcepts[c]:rowselector=rowselector+","+actconcepts[c];rowselector+='"]';for(var c=0;c<actvalues.length;c++)rowselector=rowselector+"[data-dimvals"+c+'="'+actvalues[c]+'"]';selectrow=document.querySelector(rowselector),maintable.table.dataRows.forEach(x=>x.attributes.filter.value="off"),document.querySelectorAll("tbody tr").forEach(x=>x.setAttribute("filter","off")),selectrow.setAttribute("filter","on"),maintable.table.dataRows[selectrow.getAttribute("data-id")].attributes.filter.value="on"}headerbgColor=vizData.style.themeAccentFillColor.value.color||vizData.theme.themeAccentFillColor.color;var addstyle=document.createElement("style");addstyle.id="filterstyle",addstyle.innerHTML="filteroff {opacity:50%} filteron {font-weight:bold} tr:hover {cursor: pointer;background-color: "+headerbgColor+"50;}",body.appendChild(addstyle)}maintable.on("update",(function(){resetheight(),1==vizData.style.advdistrbars.value&&distributionbar(columngroups)}))}else document.querySelectorAll("style:not(#filterstyle)").forEach(e=>e.remove());var headerbgColor=vizData.style.themeAccentFillColor.value.color||vizData.theme.themeAccentFillColor.color,headerfontColor=vizData.style.themeAccentFontColor.value.color||vizData.theme.themeAccentFontColor.color,fontColor=vizData.style.themeFontColor.value.color||vizData.theme.themeFontColor.color,gridColor=vizData.style.themeGridColor.value.color||vizData.theme.themeGridColor.color,oddrowColor=vizData.style.oddRowColor.value.color,evenrowColor=vizData.style.evenRowColor.value.color,dimnumber=vizData.fields.Dimension.length,metnumber=vizData.fields.Metric.length;comp&&(metnumber*=2);var columns=finalcols.length,headfont=vizData.style.fontfamheader.value||vizData.theme.themeAccentFontFamily,bodyfont=vizData.style.fontfambody.value||vizData.theme.themeFontFamily,increasecolor=vizData.theme.themeIncreaseColor.color,decreasecolor=vizData.theme.themeDecreaseColor.color;""==vizData.style.toprowlayout.value?toprowheight=0:toprowheight=49,vizData.style.tablerows.value>def.length&&""==vizData.style.bottomrowlayout.value?bottomrowheight=0:bottomrowheight=49;var css=document.createElement("style");css.innerHTML="table#customtable[transpose='false'] th {font-size:"+vizData.style.fontsizeheader.value+"px;line-height:"+vizData.style.fontsizeheader.value+"px}table#customtable[transpose='true'] th {font-size:"+vizData.style.fontsizebody.value+"px;line-height:"+vizData.style.fontsizebody.value+"px}table#customtable[transpose='true'] {grid-template-columns: max(max-content,"+100/(def.length+1)+"%) min(calc(100% - 100px), "+(100-100/(def.length+1))+"%)}tbody {font-size:"+vizData.style.fontsizebody.value+"px;line-height:"+vizData.style.fontsizebody.value+"px;}table#customtable[transpose='false'] tbody tr, table#customtable[transpose='true'] td, table#customtable[transpose='true'] th {border-bottom: 1px solid"+gridColor+"}.dt-top,  .dt-top select, .dt-top input {font-size:"+vizData.style.fontsizetop.value+"px;}.dt-bottom, .dt-bottom select, .dt-bottom input {font-size:"+vizData.style.fontsizebottom.value+"px;}table#customtable[transpose='false'] thead th {background-color:"+headerbgColor+";color:"+headerfontColor+"}table#customtable[transpose='true'] .dimension {background-color:"+headerbgColor+";font-size:"+vizData.style.fontsizeheader.value+"px;color:"+headerfontColor+";font-family:"+headfont+'}table#customtable[transpose="false"] thead th, table#customtable[transpose="false"] tbody td {width: '+Math.round(width/columns)+"px;  word-break: break-word;}tbody {color:"+fontColor+';}table#customtable[transpose="false"] tbody {height:calc(100% - 32px );}tbody tr:nth-child(odd){background-color:'+oddrowColor+"}tbody tr:nth-child(even){background-color:"+evenrowColor+"}table#customtable[transpose='false'] .dimension, table#customtable[transpose='true'] th {text-align:"+vizData.style.dimensionalign.value+"}table#customtable[transpose='false'] .metric,  table#customtable[transpose='true'] td  {text-align:"+vizData.style.metricalign.value+"}table#customtable[transpose='false'] .comparison {text-align:"+vizData.style.comparisonalign.value+"}.dt-table th.dt-sorter::before{border-top: 4px solid "+headerfontColor+";}.dt-table th.dt-sorter::after {border-bottom: 4px solid "+headerfontColor+";}tbody {font-family:"+bodyfont+"}table#customtable[transpose='false'] thead th {font-family:"+headfont+"}:root { --color1: "+vizData.theme.themeSeriesColor[0].color+"; --color2: "+vizData.theme.themeSeriesColor[1].color+"; --color3: "+vizData.theme.themeSeriesColor[2].color+"; --color4: "+vizData.theme.themeSeriesColor[3].color+"; --color5: "+vizData.theme.themeSeriesColor[4].color+"; --color6: "+vizData.theme.themeSeriesColor[5].color+"; --color7: "+vizData.theme.themeSeriesColor[6].color+"; --color8: "+vizData.theme.themeSeriesColor[7].color+";--accentcolor:"+headerbgColor+";--gridcolor:"+gridColor+";@property --fontcolor {syntax: '<color>';}; --fontcolor:"+fontColor+";--fontcolorRGB:"+hexToRgb(fontColor).r+","+hexToRgb(fontColor).g+","+hexToRgb(fontColor).g+";}.dt-top{float:"+vizData.style.toprowfloat.value+"}.dt-bottom{float:"+vizData.style.bottomrowfloat.value+"}",0==vizData.style.pagernumbers.value&&(css.innerHTML=css.innerHTML+".dt-pagination ul li:not(.pager) {display:none}"),"after"==vizData.style.comparrows.value&&(css.innerHTML=css.innerHTML+'td[class*="_comprel"].neg::after,  td[class*="_compabs"].neg::after{color:'+decreasecolor+'}td[class*="_comprel"].pos::after,  td[class*="_compabs"].pos::after{color:'+increasecolor+'}td[class*="_comprel"].neg::after,  td[class*="_compabs"].neg::after{content:"âž”";display: inline-block;transform: rotate(90deg);}td[class*="_comprel"].pos::after,  td[class*="_compabs"].pos::after{content:"âž”";display: inline-block;transform: rotate(-90deg)}'),"before"==vizData.style.comparrows.value&&(css.innerHTML=css.innerHTML+'td[class*="_comprel"].neg::before,  td[class*="_compabs"].neg::before{color:'+decreasecolor+'}td[class*="_comprel"].pos::before,  td[class*="_compabs"].pos::before{color:'+increasecolor+'}td[class*="_comprel"].neg::before,  td[class*="_compabs"].neg::before{content:"âž”";display: inline-block;transform: rotate(90deg);}td[class*="_comprel"].pos::before,  td[class*="_compabs"].pos::before{content:"âž”";display: inline-block;transform: rotate(-90deg)}'),body.appendChild(css),customcss=document.createElement("style"),customcss.innerHTML=vizData.style.advcss.value,body.appendChild(customcss)}catch(e){document.createElement("div");var body=document.getElementsByTagName("body")[0],tbl;(tbl=document.createElement("table")).id="errortable";var tblBody=document.createElement("tbody"),tblHead=document.createElement("thead"),headrow=document.createElement("tr"),headcell=document.createElement("th");headcell.innerText="ERROR",headrow.appendChild(headcell);var row=document.createElement("tr"),cell;(cell=document.createElement("td")).innerHTML="There seems to be an error with your configuration",e.message.indexOf("Cannot read properties of undefined")>-1&&(cell.innerHTML=cell.innerHTML+"<br> It looks like the issue could be in the 'Display Custom COLUMNS' Field. Use CONFIG MODE to see the available Fields. <br>The Input must be like: <br> dimension1,dimension2,metric1,metric1_comval,metric1_comprel"),e.message.indexOf("in JSON at position")>-1&&(cell.innerHTML=null==columnnames?cell.innerHTML+'<br> It looks like the issue could be in the <b>Name Overriding</b>. Use CONFIG MODE to see the available Fields. <br> <br>The Input for Name Overriding must be like: <br> "metric_compval":"Previous Metric Values",<br>"metric_comprel":"Change in Metric"':null==columngroups?cell.innerHTML+'<br> It looks like the issue could be in the <b>Metric Grouping</b>. Use CONFIG MODE to see the available Fields. <br><br> The Input for Metric Grouping must be like: <br>"metric":[100,500,1000],<br>"metric2":[10,20,30]':null==decprec?cell.innerHTML+'<br> It looks like the issue could be in the <b>DECIMAL PRECISION</b> Field. Use CONFIG MODE to see the available Fields.<br> <br>The Input for Decimal Precision must be like: <br> "metric":1,<br>"metric_comprel":0':cell.innerHTML+'<br> It looks like the issue could be in the <b>Name Overriding, Metric Grouping or Decimal Precision</b>. <br> <br>The Input for Name Overriding must be like: <br> "metric_compval":"Previous Metric Values",<br>"metric_comprel":"Change in Metric" <br>The Input for Decimal Precision must be like: <br> "metric":1,<br>"metric_comprel":0<br> The Input for Metric Grouping must be like: <br>"metric":[100,500,1000],<br>"metric2":[10,20,30]'),row.appendChild(cell),tblBody.appendChild(row),tblHead.appendChild(headrow),tbl.appendChild(tblHead),tbl.appendChild(tblBody),body.appendChild(tbl)}var configmode,loader;if(new JSTable("#errortable"),Element.prototype.remove=function(){this.parentElement.removeChild(this)},!0===vizData.style.advconfigmode.value&&"resize"!=action){var toprow=document.querySelector(".dt-top");toprow.innerHTML="",toprow.classList.add("configmode");var available=document.createElement("div");available.id="available";var headd=document.createElement("h2"),head;headd.innerText="CONFIGMODE",toprow.appendChild(headd),(head=document.createElement("h3")).innerText="Available Fields",toprow.appendChild(head),n=comp?5:2,fieldcount=Object.keys(dimsmets);var ending={0:"",1:"",2:"_compval",3:"_compabs",4:"_comprel"},endingNames={0:"Dimensions",1:"Metrics",2:"Comparison Values",3:"Comparison Change Absolute",4:"Comparison Change Relative"};for(i=0;i<n;i++){var listdiv=document.createElement("div"),head;(head=document.createElement("span")).innerText=endingNames[i],listdiv.appendChild(head);var list=document.createElement("ul");fieldcount.forEach((function(field){("DIMENSION"==dimsmets[field].concept&&0===i||"METRIC"==dimsmets[field].concept&&i>0)&&(listli=document.createElement("li"),listli.innerText=field+ending[i]+",",list.appendChild(listli))})),listdiv.appendChild(list),available.appendChild(listdiv)}toprow.appendChild(available);var defaults=document.createElement("div"),head,descr,descr;defaults.innerText=definput.substring(1).replaceAll(",",", "),defaults.id="defaultfields",(head=document.createElement("h3")).innerText="Default Fields Order",toprow.appendChild(head),toprow.appendChild(defaults),(descr=document.createElement("div")).innerHTML="<br><h3>See Tables CSS Classes & Data-Value Attribtues for custom CSS Input</h3>",toprow.appendChild(descr),(descr=document.createElement("div")).innerHTML='<h3>Additional Information</h3>The Table is a regular HTML with thead (Table head area) > tr (table head row) > th (table head cell) and tbody (table body area) > tr (table body row) > td (table body cell)For every cell, you can use the classes & data-value Attributes for custom CSS Styles, you can see above <br> See the <a href="https://datastudio.google.com/reporting/ff79a3a6-4f5c-4a45-9363-63869d84913f/page/fhIkC" target="_blank">Usage Guide</a> for multiple examplesYou have these classes: <br><ul><li><b>dimension/metric/comparison</b> - the type of the field</li><li><b>pos/null/neg</b> - positive /null (0 or missing) / negative</li><li><b>min/max </b>- if a value is the min value or max value of that metric or comparison</li><li><b>group0/group1/group2</b> - Group Classifications based on the Metric Grouping Thresholds</li><li><b>mymetric_comprel/qtweqfrcdxwe_compabs</b> - the name or id of the field(depending on your settings)</li><li><b>data-val</b> - the numeric/raw string data value. Unfortunately you can not use css calc function here. Use these for dimensions such as td[data-value*="google"]{} to style Cells that contain Google</li>for every tbody>tr Row you also have these attributes: <li><b>metric1="group1"</b> for changing the whole row based on your defined Metric Grouping Thresholds</li><li><b>mydimension="dimensionvalue1"</b>if you want to style the whole row based on dimension value</li></ul><br><br> <b> CSS Variables for Heatmaps & Barcharts </b><br>For Metrics & Comparisons you also have CSS Variables to calculate with in your CSS with calc(var(--val) ... ) to create bar Charts & Heatmaps. These are: <ul><li><b>--val</b> - the Value of the field</li><li><b>--minval</b> - the Minimum Value of the Column/Metric in the Table</li><li><b>--maxval</b> - the Maximum Value of the Column/Metric in the Table</li><li><b>--pctval</b> - the percentage the Value is between Min and Max(this is recommended for Heatmaps)</li><li><b>--tonullpctval</b> - the percentage the Value is between 0 and Max if Min>0 OR between Min and 0 if Max<0 OR ELSE between Min and MAX (this is recommended for Bar Charts)</li><li><b>--pctvalof0</b> - the percentage 0 is between Min and Max (this is needed for Barcharts with positive and negativ values)</li></ul> Check out the Cookbook for Examples<br><br><b>Colors</b><br>With \'Add CSS Rules\' you can also access your theme colors as CSS Variables. Just use something like td {color:var(--color1)} <br>Your available theme colors are the following: <br><li>--color1: <span style="color:var(--color1)">âˆŽ</span> </li><li>--color2: <span style="color:var(--color2)">âˆŽ</span> </li><li>--color3: <span style="color:var(--color3)">âˆŽ</span> </li><li>--color4: <span style="color:var(--color4)">âˆŽ</span> </li><li>--color5: <span style="color:var(--color5)">âˆŽ</span> </li><li>--color6: <span style="color:var(--color6)">âˆŽ</span> </li><li>--color7: <span style="color:var(--color7)">âˆŽ</span> </li><li>--color8: <span style="color:var(--color8)">âˆŽ</span> </li><br> <br> <b> Changing Column Width </b> <br>When changing the width, the table tries to keep every column in good balance. A <b>width:300px</b> might be less in the table. Use <b>min-width:300px</b> instead, if you need to have more space  & <b>max-width:300px</b> for reducing width. <br> if you exceed the available space with using min-width for everything, the table becomes scrollable on the x axis.<br> <br> <b> Top Row & Bottom Row</b><br> In the Style Settings, you can edit Top Row and Bottom Row Elements and their Text. By default you see {info} and {pager} . Other possible elements are {date} {select} and {search}. <br> some of them can be added only once per table <br> {pager} is mandatory and will show up in Bottom Row if the table when there are to many rows even if it\'s not in the elements field. If you don\'t want that, add <b>.dt-pagination {display: none;} </b> to the "Add CSS Rules" field',body.appendChild(descr)}(loader=document.querySelector("#loaders"))?loader.style="display:none":((loader=document.createElement("div")).id="loaders",loader.style="display:none",document.body.appendChild(loader))}function resetheight(){document.querySelector("#csslater")&&document.querySelector("#csslater").remove();var headheight=document.querySelector("thead").offsetHeight,toprowheight=document.querySelector(".dt-top:not(.configmode)")?document.querySelector(".dt-top:not(.configmode)").offsetHeight:0,bottomrowheight=document.querySelector(".dt-bottom").offsetHeight,css2=document.createElement("style");css2.id="csslater",css2.innerHTML="table#customtable[transpose=false] tbody {height:calc(100% - "+headheight+"px );}.dt-container, #customtable {height:"+(height-toprowheight-bottomrowheight-1)+"px}",document.body.appendChild(css2)}function sendinteraction(data){var FILTER=dscc.InteractionType.FILTER;dscc.sendInteraction("crossfilter",FILTER,data)}function clearInteraction(){var FILTER=dscc.InteractionType.FILTER;dscc.clearInteraction("crossfilter",FILTER)}!function(e,R){"object"==typeof exports&&"object"==typeof module?module.exports=R():"function"==typeof define&&define.amd?define("dscc",[],R):"object"==typeof exports?exports.dscc=R():e.dscc=R()}(window,(function(){return C={},n.m=t={"./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/*! no static exports found */function(e,N,R){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var R,t=1,C=arguments.length;t<C;t++)for(var n in R=arguments[t])Object.prototype.hasOwnProperty.call(R,n)&&(e[n]=R[n]);return e}).apply(this,arguments)};Object.defineProperty(N,"__esModule",{value:!0});
/*!
  @license
  Copyright 2019 Google LLC

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
*/
var a=R(/*! ./types */"./src/types.ts");function E(e){return e.type===a.ConfigDataElementType.DIMENSION||e.type===a.ConfigDataElementType.METRIC}function r(e){return e===a.ConfigDataElementType.DIMENSION?-1:1}function _(e){var R=[];e.config.data.forEach((function(e){e.elements.filter(E).forEach((function(e){R.push(e)}))}));var t,C=(t=function(e,R){return r(e.type)-r(R.type)},R.map((function(e,R){return{item:e,index:R}})).sort((function(e,R){return t(e.item,R.item)||e.index-R.index})).map((function(e){return e.item}))),n=[];return C.forEach((function(e){e.value.forEach((function(){return n.push(e.id)}))})),n}function o(R){return function(e){var t,C,n={};return C=R,((t=e).length<C.length?t.map((function(e,R){return[e,C[R]]})):C.map((function(e,R){return[t[R],e]}))).forEach((function(e){var R=e[0],t=e[1];void 0===n[t]&&(n[t]=[]),n[t].push(R)}),{}),n}}function U(e){var R={};return(e.config.style||[]).forEach((function(e){e.elements.forEach((function(e){if(void 0!==R[e.id])throw new Error("styleIds must be unique. Your styleId: '"+e.id+"' is used more than once.");R[e.id]={value:e.value,defaultValue:e.defaultValue}}))}),{}),R}function Y(e){return e.config.themeStyle}function n(e){switch(e){case a.DSInteractionType.FILTER:return a.InteractionType.FILTER}}function s(e){var R=e.config.interactions;return void 0===R?{}:R.reduce((function(e,R){var t=R.supportedActions.map(n),C={type:n(R.value.type),data:R.value.data};return e[R.id]={value:C,supportedActions:t},e}),{})}function u(e){return(e.dataResponse.dateRanges||[]).reduce((function(e,R){return e[R.id]={start:R.start,end:R.end},e}),{})}function T(e){var R=e.dataResponse.colorMap||{};return i({},R)}function c(e){var R,t=!1;return e===N.tableTransform||e===N.objectTransform?t=!0:(R=!1,"identity"===e("identity")&&(R=!0,console.warn("This is an unsupported data format. Please use one of the supported transforms:\n       dscc.objectFormat or dscc.tableFormat.")),R&&(t=!0)),t}!function(e){for(var R in e)N.hasOwnProperty(R)||(N[R]=e[R])}(R(/*! ./types */"./src/types.ts")),N.getWidth=function(){return document.body.clientWidth},N.getHeight=function(){return document.documentElement.clientHeight},N.getComponentId=function(){var e=new URLSearchParams(window.location.search);if(null!==e.get("dscId"))return e.get("dscId");throw new Error("dscId must be in the query parameters. This is a bug in ds-component, please file a bug: https://github.com/googledatastudio/ds-component/issues/new")},N.fieldsByConfigId=function(e){var R=e.fields.reduce((function(e,R){return e[R.id]=R,e}),{}),t={};return e.config.data.forEach((function(e){e.elements.filter(E).forEach((function(e){t[e.id]=e.value.map((function(e){return R[e]}))}))})),t},N.tableTransform=function(e){return{tables:(R=e,C=N.fieldsByConfigId(R),n=_(R),E={},r=n.map((function(e){void 0===E[e]?E[e]=0:E[e]++;var R=E[e],t=C[e][R];return i(i({},t),{configId:e})})),(t={})[a.TableType.DEFAULT]={headers:[],rows:[]},o=t,R.dataResponse.tables.forEach((function(e){o[e.id]={headers:r,rows:e.rows}})),o),dateRanges:u(e),fields:N.fieldsByConfigId(e),style:U(e),theme:Y(e),interactions:s(e),colorMap:T(e)};var R,t,C,n,E,r,o},N.objectTransform=function(e){return{tables:(C=_(R=e),(t={})[a.TableType.DEFAULT]=[],n=t,R.dataResponse.tables.forEach((function(e){var R=e.rows.map(o(C));e.id===a.TableType.DEFAULT?n[e.id]=R:(void 0===n[e.id]&&(n[e.id]=[]),n[e.id]=n[e.id].concat(R))})),n),dateRanges:u(e),fields:N.fieldsByConfigId(e),style:U(e),theme:Y(e),interactions:s(e),colorMap:T(e)};var R,t,C,n},N.subscribeToData=function(R,t){if(c(t.transform)){var e=function(e){e.data.type===a.MessageType.RENDER?R(t.transform(e.data)):console.error("MessageType: "+e.data.type+" is not supported by this version of the library.")};window.addEventListener("message",e);var C={componentId:N.getComponentId(),type:a.ToDSMessageType.VIZ_READY};return window.parent.postMessage(C,"*"),function(){return window.removeEventListener("message",e)}}throw new Error("Only the built in transform functions are supported.")},N.sendInteraction=function(e,R,t){var C=N.getComponentId(),n={type:a.ToDSMessageType.INTERACTION,id:e,data:t,componentId:C};window.parent.postMessage(n,"*")},N.clearInteraction=function(e,R){N.sendInteraction(e,R,void 0)}},"./src/types.ts":
/*!**********************!*\
  !*** ./src/types.ts ***!
  \**********************/
/*! no static exports found */function(e,R,t){"use strict";var C,n,E,r,o,N,i;Object.defineProperty(R,"__esModule",{value:!0}),(C=R.ConceptType||(R.ConceptType={})).METRIC="METRIC",C.DIMENSION="DIMENSION",(R.MessageType||(R.MessageType={})).RENDER="RENDER",(n=R.FieldType||(R.FieldType={})).YEAR="YEAR",n.YEAR_QUARTER="YEAR_QUARTER",n.YEAR_MONTH="YEAR_MONTH",n.YEAR_WEEK="YEAR_WEEK",n.YEAR_MONTH_DAY="YEAR_MONTH_DAY",n.YEAR_MONTH_DAY_HOUR="YEAR_MONTH_DAY_HOUR",n.QUARTER="QUARTER",n.MONTH="MONTH",n.WEEK="WEEK",n.MONTH_DAY="MONTH_DAY",n.DAY_OF_WEEK="DAY_OF_WEEK",n.DAY="DAY",n.HOUR="HOUR",n.MINUTE="MINUTE",n.DURATION="DURATION",n.COUNTRY="COUNTRY",n.COUNTRY_CODE="COUNTRY_CODE",n.CONTINENT="CONTINENT",n.CONTINENT_CODE="CONTINENT_CODE",n.SUB_CONTINENT="SUB_CONTINENT",n.SUB_CONTINENT_CODE="SUB_CONTINENT_CODE",n.REGION="REGION",n.REGION_CODE="REGION_CODE",n.CITY="CITY",n.CITY_CODE="CITY_CODE",n.METRO_CODE="METRO_CODE",n.LATITUDE_LONGITUDE="LATITUDE_LONGITUDE",n.NUMBER="NUMBER",n.PERCENT="PERCENT",n.TEXT="TEXT",n.BOOLEAN="BOOLEAN",n.URL="URL",n.IMAGE="IMAGE",n.CURRENCY_AED="CURRENCY_AED",n.CURRENCY_ALL="CURRENCY_ALL",n.CURRENCY_ARS="CURRENCY_ARS",n.CURRENCY_AUD="CURRENCY_AUD",n.CURRENCY_BDT="CURRENCY_BDT",n.CURRENCY_BGN="CURRENCY_BGN",n.CURRENCY_BOB="CURRENCY_BOB",n.CURRENCY_BRL="CURRENCY_BRL",n.CURRENCY_CAD="CURRENCY_CAD",n.CURRENCY_CDF="CURRENCY_CDF",n.CURRENCY_CHF="CURRENCY_CHF",n.CURRENCY_CLP="CURRENCY_CLP",n.CURRENCY_CNY="CURRENCY_CNY",n.CURRENCY_COP="CURRENCY_COP",n.CURRENCY_CRC="CURRENCY_CRC",n.CURRENCY_CZK="CURRENCY_CZK",n.CURRENCY_DKK="CURRENCY_DKK",n.CURRENCY_DOP="CURRENCY_DOP",n.CURRENCY_EGP="CURRENCY_EGP",n.CURRENCY_ETB="CURRENCY_ETB",n.CURRENCY_EUR="CURRENCY_EUR",n.CURRENCY_GBP="CURRENCY_GBP",n.CURRENCY_HKD="CURRENCY_HKD",n.CURRENCY_HRK="CURRENCY_HRK",n.CURRENCY_HUF="CURRENCY_HUF",n.CURRENCY_IDR="CURRENCY_IDR",n.CURRENCY_ILS="CURRENCY_ILS",n.CURRENCY_INR="CURRENCY_INR",n.CURRENCY_IRR="CURRENCY_IRR",n.CURRENCY_ISK="CURRENCY_ISK",n.CURRENCY_JMD="CURRENCY_JMD",n.CURRENCY_JPY="CURRENCY_JPY",n.CURRENCY_KRW="CURRENCY_KRW",n.CURRENCY_LKR="CURRENCY_LKR",n.CURRENCY_LTL="CURRENCY_LTL",n.CURRENCY_MNT="CURRENCY_MNT",n.CURRENCY_MVR="CURRENCY_MVR",n.CURRENCY_MXN="CURRENCY_MXN",n.CURRENCY_MYR="CURRENCY_MYR",n.CURRENCY_NOK="CURRENCY_NOK",n.CURRENCY_NZD="CURRENCY_NZD",n.CURRENCY_PAB="CURRENCY_PAB",n.CURRENCY_PEN="CURRENCY_PEN",n.CURRENCY_PHP="CURRENCY_PHP",n.CURRENCY_PKR="CURRENCY_PKR",n.CURRENCY_PLN="CURRENCY_PLN",n.CURRENCY_RON="CURRENCY_RON",n.CURRENCY_RSD="CURRENCY_RSD",n.CURRENCY_RUB="CURRENCY_RUB",n.CURRENCY_SAR="CURRENCY_SAR",n.CURRENCY_SEK="CURRENCY_SEK",n.CURRENCY_SGD="CURRENCY_SGD",n.CURRENCY_THB="CURRENCY_THB",n.CURRENCY_TRY="CURRENCY_TRY",n.CURRENCY_TWD="CURRENCY_TWD",n.CURRENCY_TZS="CURRENCY_TZS",n.CURRENCY_UAH="CURRENCY_UAH",n.CURRENCY_USD="CURRENCY_USD",n.CURRENCY_UYU="CURRENCY_UYU",n.CURRENCY_VEF="CURRENCY_VEF",n.CURRENCY_VND="CURRENCY_VND",n.CURRENCY_YER="CURRENCY_YER",n.CURRENCY_ZAR="CURRENCY_ZAR",(E=R.TableType||(R.TableType={})).DEFAULT="DEFAULT",E.COMPARISON="COMPARISON",E.SUMMARY="SUMMARY",(r=R.DateRangeType||(R.DateRangeType={})).DEFAULT="DEFAULT",r.COMPARISON="COMPARISON",(o=R.ConfigDataElementType||(R.ConfigDataElementType={})).METRIC="METRIC",o.DIMENSION="DIMENSION",o.MAX_RESULTS="MAX_RESULTS",(N=R.ConfigStyleElementType||(R.ConfigStyleElementType={})).TEXTINPUT="TEXTINPUT",N.SELECT_SINGLE="SELECT_SINGLE",N.CHECKBOX="CHECKBOX",N.FONT_COLOR="FONT_COLOR",N.FONT_SIZE="FONT_SIZE",N.FONT_FAMILY="FONT_FAMILY",N.FILL_COLOR="FILL_COLOR",N.BORDER_COLOR="BORDER_COLOR",N.AXIS_COLOR="AXIS_COLOR",N.GRID_COLOR="GRID_COLOR",N.OPACITY="OPACITY",N.LINE_WEIGHT="LINE_WEIGHT",N.LINE_STYLE="LINE_STYLE",N.BORDER_RADIUS="BORDER_RADIUS",N.INTERVAL="INTERVAL",N.SELECT_RADIO="SELECT_RADIO",(R.DSInteractionType||(R.DSInteractionType={})).FILTER="FILTER",(i=R.ToDSMessageType||(R.ToDSMessageType={})).VIZ_READY="vizReady",i.INTERACTION="vizAction",(R.InteractionType||(R.InteractionType={})).FILTER="FILTER"}},n.c=C,n.d=function(e,R,t){n.o(e,R)||Object.defineProperty(e,R,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(R,e){if(1&e&&(R=n(R)),8&e)return R;if(4&e&&"object"==typeof R&&R&&R.__esModule)return R;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:R}),2&e&&"string"!=typeof R)for(var C in R)n.d(t,C,function(e){return R[e]}.bind(null,C));return t},n.n=function(e){var R=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(R,"a",R),R},n.o=function(e,R){return Object.prototype.hasOwnProperty.call(e,R)},n.p="",n(n.s="./src/index.ts");function n(e){if(C[e])return C[e].exports;var R=C[e]={i:e,l:!1,exports:{}};return t[e].call(R.exports,R,R.exports,n),R.l=!0,R.exports}var t,C})),dscc.subscribeToData(prerendercheck,{transform:dscc.objectTransform});var filterdata="",alldata="";function prerendercheck(vizData){if(starttime=(new Date).getTime(),alldata==JSON.stringify(vizData))drawViz(vizData,"resize"),resetheight();else if(alldata=JSON.stringify(vizData),newfilterdata=JSON.stringify(vizData.interactions.crossfilter.value.data),""==filterdata)filterdata=newfilterdata,(loader=document.createElement("div")).id="loaders",loader.style="display:block",document.body.appendChild(loader),setTimeout((function(){drawViz(vizData,"firstbuild")}),1);else if(filterdata===newfilterdata){var loader=document.querySelector("#loaders");loader&&(loader.style="display:block"),setTimeout((function(){drawViz(vizData,"rebuild")}),1)}else filterdata=newfilterdata,null==vizData.interactions.crossfilter.value.data&&document.querySelectorAll("tbody tr").forEach((function(element){element.setAttribute("filter","none")}))}function distributionbar(columngroups){for(var keys=Object.keys(columngroups),i=0;i<keys.length;i++)if(document.querySelector("th."+keys[i])){var headcell=document.querySelector("th."+keys[i]),chart=document.createElement("div"),maxnums=[];chart.classList.add("distrbars");for(var j=0;j<columngroups[keys[i]].length+1;j++){var rowname=0==j?"<="+columngroups[keys[i]][j]:">"+columngroups[keys[i]][j-1],number=0;maintable.table.dataRows.forEach((function(row){row.cells.forEach((function(cell){cell.attributes["data-field"]==keys[i]&&cell.attributes["data-group"]==j&&(number+=1)}))})),maxnums.push(number),chart.innerHTML=chart.innerHTML+'<div class="distrbarname">'+rowname+'</div><div class="distrbarval" style="--distrval:'+number+';">'+number+"</div>"}chart.querySelectorAll(".distrbarval").forEach((function(bar){bar.setAttribute("style",bar.getAttribute("style")+"--distrmaxval:"+Math.max(...maxnums))})),headcell.appendChild(chart)}}function hexToRgb(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null}